name: GitHub Actions Demo Build Kotlin
run-name: ${{ github.actor }} is testing out GitHub Actions, this time to build and run kotlin files üöÄ

on:
  workflow_dispatch:
  pull_request:
    branches:
      - main

jobs:
  Build-SW-without-warnings:              # job 1, run and test kotlin
    needs: Install-and-run-groovy         # just a tryout, job 1 needs to wait for job 2
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
        
      - name: Build SW 
        run: |
          kotlinc -Werror src/hello.kt -include-runtime -d hello.jar
          kotlinc -Werror src/crc32.kt -include-runtime -d crc32.jar
          kotlinc -cp ./src/junit-4.13.2.jar -include-runtime -d tests.jar src/test/Crc32Tests.kt src/test/MD5Tests.kt src/crc32.kt
          ls ${{ github.workspace }}
          
      - name: Run application
        run: |
          java -jar hello.jar BINGO BULL
          java -jar crc32.jar
          echo "üçè This job's status is ${{ job.status }}."
          
      - name: Run unit tests
        run: java -jar src/junit-platform-console-standalone-1.7.2.jar --class-path tests.jar --scan-class-path

      - name: Archive code coverage results
        uses: actions/upload-artifact@v4
        with:
          name: executable
          path: hello.jar
          
  Install-and-run-groovy:              # job 2, install and runn groovy
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Install Groovy
        run: |
          curl -s "https://get.sdkman.io" | bash
          source "$HOME/.sdkman/bin/sdkman-init.sh"
          sdk install groovy
          groovy --version

      - name: Run Groovy script
        run: |
          source "$HOME/.sdkman/bin/sdkman-init.sh"
          groovy src/helloWorld.groovy
